<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HiFi Dashboard</title>

<!-- JustGage and Raphael (for gauges) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.3.5/justgage.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>

<script>
const socket = io();
const gauges = {};

document.addEventListener("DOMContentLoaded", function() {
    {% for comp in components %}
    gauges["{{ comp }}"] = new JustGage({
        id: "vu_{{ loop.index }}",
        value: 0,
        min: 0,
        max: 100,
        title: "",
        label: "",
        pointer: true,
        gaugeWidthScale: 0.6
    });
    {% endfor %}
});

// When backend sends an update:
socket.on("status_update", function(data) {
    // Update running indicators
    for (let comp in data.running) {
        const el = document.querySelector(".run-indicator-" + comp);
        if (data.running[comp]) el.classList.add("on");
        else el.classList.remove("on");
    }

    // Update selected indicators
    for (let comp in data.selected) {
        const el = document.querySelector(".select-" + comp);
        if (data.selected[comp]) el.classList.add("on");
        else el.classList.remove("on");
    }

    // Update VU meters
    for (let comp in data.vu) {
        gauges[comp].refresh(data.vu[comp]);
    }
});
</script>
<style>
  /* ------------------------ */
  /* Base body */
  body {
    margin: 0;
    font-family: "Arial", sans-serif;
    background: #222;
    color: #eee;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }

  /* ------------------------ */
  /* Header / Kill All column */
  .dashboard {
    display: flex;
    flex: 0 0 300px;       /* Fixed height */
    width: 100%;
    background: #333;
    box-shadow: inset 0 -4px 8px rgba(0,0,0,0.7), inset 0 4px 8px rgba(255,255,255,0.05);
  }

  /* Each column */
  .column {
    flex: 1;
    margin: 5px;
    background: linear-gradient(145deg, #444, #222);
    border: 2px solid #666;
    border-radius: 10px;
    box-shadow: inset -2px -2px 4px rgba(255,255,255,0.1),
                inset 2px 2px 4px rgba(0,0,0,0.7);
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    padding: 10px;
  }

  /* Select button */
  .select-button {
      flex: 0 0 50px;
      width: 100%;
      text-align: center;
      font-size: 1.2em;
      font-weight: bold;
      line-height: 50px;
      cursor: pointer;
      border-radius: 5px;
      border: 2px solid #555;
      transition: all 0.2s;
  }

  /* Select state colors */
  .select-button.on {
      background: #4caf50;
      color: black;
      border-color: #2e7d32;
  }

  .select-button {
      background: #555;
      color: #eee;
      border-color: #333;
  }

  /* Button row */
  .button-row {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
  }

  /* Button style */
  .btn {
    position: relative;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 2px solid #999;
    background: linear-gradient(145deg, #555, #222);
    box-shadow: inset -2px -2px 4px rgba(255,255,255,0.2),
                inset 2px 2px 4px rgba(0,0,0,0.7),
                2px 2px 5px rgba(0,0,0,0.5);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #eee;
    font-size: 22px;
  }

  /* Status indicator */
  .indicator {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background: #555;
    border: 1px solid #222;
    box-shadow: 0 0 4px rgba(0,0,0,0.7);
  }

  .indicator.on {
    background: #0f0;
    box-shadow: 0 0 6px #0f0;
  }

  /* Kill All column */
  .kill-column {
    flex: 0 0 150px;
    margin: 5px;
    background: linear-gradient(145deg, #333, #111);
    border: 2px solid #666;
    border-radius: 10px;
    box-shadow: inset -2px -2px 4px rgba(255,255,255,0.1),
                inset 2px 2px 4px rgba(0,0,0,0.7);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 10px;
  }

  .kill-column .btn {
    width: 80px;
    height: 80px;
    font-size: 28px;
    border-color: #c33;
    background: linear-gradient(145deg, #922, #511);
    box-shadow: inset -2px -2px 6px rgba(255,100,100,0.2),
                inset 2px 2px 6px rgba(0,0,0,0.7),
                2px 2px 6px rgba(0,0,0,0.5);
  }

  /* Icon styles (optional) */
  .btn i {
    pointer-events: none;
  }

  /* VU-meters */
  .vu {
    background: #111;
    border-radius: 8px;
    box-shadow: inset -2px -2px 6px rgba(255,255,255,0.1),
                inset 2px 2px 6px rgba(0,0,0,0.7);
}

</style>

</head>
<body>

<div class="dashboard">
  <!-- Kill All column -->
  <div class="kill-column">
    <div class="column-title">Kill All</div>
    <button class="btn" onclick="killAll()">⏻</button>
  </div>

  <!-- Component columns -->
  {% for comp in components %}
  <div class="column">
    <div class="select-button select-{{ comp }}"
         onclick="selectComponent({{ loop.index }})">
        {{ comp }}
    </div>

    <div class="button-row">
      <!-- Launch button -->
      <div style="position: relative;">
        <button class="btn" onclick="toggleComponent({{ loop.index }})">⏻</button>
            <div class="indicator run-indicator-{{ comp }}"></div>
      </div>

    </div>

    <!-- Placeholder for VU meter -->
    <div class="vu" id="vu_{{ loop.index }}" style="width:100%; height:120px;"></div>
  </div>
  {% endfor %}
</div>

<script src="{{ url_for('static', filename='dashboard.js') }}"></script>
</body>
</html>
